{
  "hash": "fe34477080fcf24cda45a92fe22e822b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Biodiversity: What and How\"\ndate: 2024-10-15\nimage: https://images.unsplash.com/photo-1461018143319-6058c04a8dd9?q=80&w=3658&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\n# abstract: \n# description: \ncategories:\n  - Ecology\n  - Community Ecology\n  - Data Analysis\n  - Multivariate Analysis\nformat:\n  html:\n    resources: \n      - shinylive-sw.js\nfilters:\n  - openlinksinnewpage\n  - nutshell\n  - shinylive\nexecute:\n  echo: true\ncitation: true\ndraft: true\n--- \n\n::: {.cell}\n\n:::\n\n\n\n::: {.disclaimer}\nPart of this note is taken from the course *Community Ecology* offered by [University of Hamburg](https://www.biologie.uni-hamburg.de/en.html) for M.Sc. Biology program and led by [Dr. Paula Cabral Eterovick](https://www.researchgate.net/profile/Paula-Eterovick-2). \n\nThe cover image is credited to [Conor Rees on Unsplash](https://images.unsplash.com/photo-1461018143319-6058c04a8dd9?q=80&w=3658&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D).\n\n:::\n\n::: {.callout-caution appearance=\"minimal\" style=\"font-sze:0.9rem; border-left: none; border: 1px solid var(--clcolor);\" collapse=\"true\"}\n\n## [R Setup]{.cl-sub}\n\n```r\n# setup\nlibrary(tidyverse)\nlibrary(vegan)\n```\n\n:::\n\n<br>\n\n## Biodiversity\n\nProper assessing biodiversity is foundation of many subsequent analyses in ecology. We surely often heard the term \"Biodiversity\", and we all know what that means. But how do we quantify it in research? How do we compare biodiversity in time-space? The term is divided into three terms in ecology: the **alpha**, **beta** and **gamma** diversity. \n\nSimply speaking, alpha diversity refers to the diversity within a particular area or ecosystem. Beta diversity measures the difference between these areas. And gamma diversity encloses the diversity of all areas and represents an overall diversity. If we simply use the number of species present (species richness) as the measurement of biodiversity, these three types of diversity can be illustrated as follow:\n\n|                 | Habitat I   | Habitat II   | Habitat III   |\n| :-------------- | :---------- | :----------- | :------------ |\n| Species A       | x           |              |               |\n| Species B       | x           |              |               |\n| Species C       | x           | x            |               |\n| Species D       | x           | x            |               |\n| Species E       |             | x            |               |\n| Species F       |             | x            |               |\n| Species G       |             | x            |               |\n| Species H       |             | x            | x             |\n| Species I       |             |              | x             |\n| Species J       |             |              | x             |\n|                 |             |              |               |\n| **Alpha Diversity** | 4           | 6            | 3             |\n| **Beta Diversity**  | I vs. II: 6 | I vs. III: 7 | II vs. III: 7 |\n| Unique species  | A, B, E, F  | All species  | C, D, E, F, G, I, J |\n| **Gamma Diversity** |             | 10           |               |\n\n: Illustration of different types of diversity calculated by species richness. `x` indicates species' presence. Alpha diversity sums up species present in each habitat, beta diversity counts for unique species in both habitats, gamma diversity represents number of species ever present. {#tbl-diversities}\n\n## Alpha Diversity\n\n### Species Richness\n\nLike we just did in @tbl-diversities, assessing diversity with species richness (SR) data is the most intuitive and straightforward way, but it also has many limitations. First of all, it does not provide abundance data, we could only know how many species are present, but not in what extent. This means that if we encountered a common species and a rare species, they are equally treated in SR. At the same time, it's sensitive to sample size, and this response is not linear. Which means assuming our sampling is completely random (idealy), the probability of encountering a rare species increases as our sampling effort. But the increase of the total number of encountered species will become slower, and the response curve will then reach a plateau. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\ngspecies <- round(rgamma(1000, 50), digit = 0)\n\ncount_species <- function(n, pool) {\n    sampling <- replicate(n, sample(pool, 1, replace = T))\n    df <- data.frame(effort = 1:n)\n    df$species.count <- map_int(df$effort, \\(x) length(unique(sampling[1:x])))\n    df$sample <- map_chr(df$effort, \\(x) as.character(sampling[x]))\n    return(df)\n}\n\ndf <- count_species(200, gspecies)\n\nmax <- max(df$species.count)*1.1\n\nclr <- zhehaoColor(\"elbfaehre\")\n\nggplot() +\n    use_palette_ggplot(\"elbfaehre\") +\n    geom_step(data = df, aes(x = effort, y = species.count), direction = \"hv\", color = clr[1]) +\n    annotate(\"text\", x = 200, y = max, label = \"n = 200\", color = clr[1]) +\n    annotate(\"text\", x = 150, y = 7, label = paste0(\"Total species in pool: \", length(unique(gspecies)))) +\n    labs(x = \"Sampling effort\", y = \"Encountered Species\")\n```\n\n::: {.cell-output-display}\n![Simulation of random sampling from a species pool. Species occurrance are not equal (i.e. there are common and rare species). Y axis represents accumulated species count.](draftBiodiversity_files/figure-html/fig-species-count-1.png){#fig-species-count fig-align='center' width=672}\n:::\n:::\n\n\n\nBecause of this non-linear course of the SR curve, we cannot compare SR from different site by simply compare the species count devided by sample size. An widely used alternative is rarefaction, but \n\n\n\n::: {.cell .column-page layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nclr <- zhehaoColor(\"copenhagen3\", 10)\n\nsimulate.field <- function(index, sampling.effort) {\n\n    species.pool <- round(\n        rgamma(\n            n = 1000, # use gamma distribution to generate uneven species abundance\n            shape = runif(1, 5, 200) # randomize gamma distribution for every simulation\n            ), digit = 0)\n    \n    # sampling from species pool\n    sampling <- replicate(sampling.effort, sample(species.pool, 1, replace = T)) \n\n    # organize data\n    df <- data.frame(effort = 1:sampling.effort)\n    df$species.count <- map_int(df$effort, \\(x) length(unique(sampling[1:x])))\n    df$sample <- map_chr(df$effort, \\(x) as.character(sampling[x]))\n    df$site <- LETTERS[index]\n\n    sim <- list(df = df, sp.pool = length(unique(species.pool)))\n    return(sim)\n}\n\nn <- 15 # number of simulation\n\nsim.index <- data.frame(index = c(1:n), efforts = c(runif(n, 150, 500))) # random effort for each simulation\n\nsim <- map2(sim.index$index, sim.index$efforts, \\(x, y) simulate.field(x, y)) %>% list_transpose()\nsim.sample <- list_rbind(sim$df)\n\n# Plot species count curve\nsim.sample %>% group_by(site) %>% ggplot() +\n    geom_step(aes(x = effort, y = species.count, color = site), direction = \"hv\") +\n    geom_text(\n        data = sim.sample %>% \n            group_by(site) %>% \n            summarise(max_x = max(effort), max_y = max(species.count)),\n        aes(\n            x = max_x + 50, \n            y = max_y, \n            label = paste0(site, \": \", max_y, \" (\", sim$sp.pool, \")\"), \n            color = site), \n        check_overlap = F) +\n    xlim(c(-5, 600)) +\n    use_palette_ggplot(\"porco\", n) +\n    labs(x = \"Sample\", y = \"Species\") +\n    theme(legend.position = \"none\")\n\n# Summarize abundance matrix \ncommunity <- map_df(c(1:length(sim$df)), \\(x) summary(factor(sim$df[[x]]$sample)))\ncommunity[is.na(community)] <- 0\ncommunity <- as.data.frame(community)\nrownames(community) <- LETTERS[1:n]\n\n# Rarefy\nraremin <- min(rowSums(community, na.rm = T)) # least effort (sample size) of all sites (simulations) \nrarefied <- tibble(Site = LETTERS[1:n], Rarefied_SR = rarefy(community, raremin)) %>% arrange(desc(Rarefied_SR))\n\n# Prepare for plot\nrarefied.txt <- paste(rarefied$Site, round(rarefied$Rarefied_SR, digit = 3), sep = \": \")\nrarefied.tbl <- paste0(\"Rarefied SR \\n\\n\", paste(rarefied.txt, collapse = \"\\n\"))\n\n# Rarefaction curve\ntidy.rare <- rarecurve(community, tidy = T) # `tidy = TRUE` will return a matrix for ggplot processing instead of directly drawing a plot\ntidy.rare %>% ggplot() +\n    geom_vline(aes(xintercept = raremin), color = \"#BBB8\", linetype = \"dashed\") + # raremin line\n    geom_line(aes(x = Sample, y = Species, color=Site)) +\n    geom_text(\n        data = tidy.rare %>% \n            group_by(Site) %>% \n            summarise(max_x = max(Sample), max_y = max(Species)) %>% \n            mutate(index = match(Site, LETTERS)), \n        aes(\n            x = max_x + 50, \n            y = max_y, \n            label = paste0(Site, \": \", max_y, \" (\", sim$sp.pool, \")\"), \n            color = Site), \n        check_overlap = F) +\n    annotate(\"text\", x = 660, y = 30, label = rarefied.tbl) +\n    xlim(c(-5, 700)) +\n    use_palette_ggplot(\"porco\", n) +\n    theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Species accumulation curve.](draftBiodiversity_files/figure-html/fig-rarefaction-curve-1.png){#fig-rarefaction-curve-1 fig-align='center' width=672}\n:::\n\n::: {.cell-output-display}\n![Rarefaction curve.](draftBiodiversity_files/figure-html/fig-rarefaction-curve-2.png){#fig-rarefaction-curve-2 fig-align='center' width=672}\n:::\n:::\n\n\n\n\n## Reference\n\n::: {#refs}\n:::\n\n::: {.callout-caution appearance=\"minimal\" style=\"font-sze:0.9rem; border-left: none; border: 1px solid var(--clcolor);\" collapse=\"true\"}\n\n## [R session and R packages]{.cl-title}\n\n\n\n#### R session \n\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.5\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] vegan_2.6-8             lattice_0.22-6          permute_0.9-7          \n [4] zhehaoColors_0.0.0.9000 lubridate_1.9.3         forcats_1.0.0          \n [7] stringr_1.5.1           dplyr_1.1.4             purrr_1.0.2            \n[10] readr_2.1.5             tidyr_1.3.1             tibble_3.2.1           \n[13] ggplot2_3.5.1           tidyverse_2.0.0         pacman_0.5.1           \n\n\n#### Packages \n\n\n\n**pacman**\n\n\nVersion: 0.5.1 \n\nRinker TW, Kurkiewicz D (2018). _pacman: Package Management for R_.\nversion 0.5.0, <http://github.com/trinker/pacman>.\n\n\n**tidyverse**\n\n\nVersion: 2.0.0 \n\nWickham H, Averick M, Bryan J, Chang W, McGowan LD, François R,\nGrolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E,\nBache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi\nK, Vaughan D, Wilke C, Woo K, Yutani H (2019). \"Welcome to the\ntidyverse.\" _Journal of Open Source Software_, *4*(43), 1686.\ndoi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.\n\n\n**zhehaoColors**\n\n\nVersion: 0.0.0.9000 \n\nHu Z (2024). _zhehaoColors: Using Aesthetics From Zhehao's\nPhotographs_. R package version 0.0.0.9000.\n\n\n**vegan**\n\n\nVersion: 2.6.8 \n\nOksanen J, Simpson G, Blanchet F, Kindt R, Legendre P, Minchin P,\nO'Hara R, Solymos P, Stevens M, Szoecs E, Wagner H, Barbour M, Bedward\nM, Bolker B, Borcard D, Carvalho G, Chirico M, De Caceres M, Durand S,\nEvangelista H, FitzJohn R, Friendly M, Furneaux B, Hannigan G, Hill M,\nLahti L, McGlinn D, Ouellette M, Ribeiro Cunha E, Smith T, Stier A, Ter\nBraak C, Weedon J (2024). _vegan: Community Ecology Package_. R package\nversion 2.6-8, <https://CRAN.R-project.org/package=vegan>.\n\n\n:::\n",
    "supporting": [
      "draftBiodiversity_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}