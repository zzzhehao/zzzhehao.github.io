{
  "hash": "7aa952c9d8d0d6add8e78dd2796cc854",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Biodiversity: What and How\"\ndate: 2024-10-15\nimage: https://images.unsplash.com/photo-1461018143319-6058c04a8dd9?q=80&w=3658&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D\n# abstract: \n# description: \ncategories:\n  - Ecology\n  - Community Ecology\n  - Data Analysis\n  - Multivariate Analysis\nfilters:\n  - openlinksinnewpage\n  - nutshell\n  - shinylive\nexecute:\n  echo: true\ncitation: true\ndraft: true\nnumber-sections: false\n--- \n\n::: {.cell}\n\n:::\n\n\n\n::: {.disclaimer}\nPart of this note is taken from the course *Community Ecology* offered by [University of Hamburg](https://www.biologie.uni-hamburg.de/en.html) for M.Sc. Biology program and led by [Dr. Paula Cabral Eterovick](https://www.researchgate.net/profile/Paula-Eterovick-2). \n\nThe cover image is credited to [Conor Rees on Unsplash](https://images.unsplash.com/photo-1461018143319-6058c04a8dd9?q=80&w=3658&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D).\n\n:::\n\n::: {.callout-caution appearance=\"minimal\" style=\"font-sze:0.9rem; border-left: none; border: 1px solid var(--clcolor);\" collapse=\"true\"}\n\n## [R Setup]{.cl-sub}\n\n```r\n# setup\nlibrary(tidyverse)\nlibrary(vegan)\n```\n\n:::\n\n<br>\n\n## Biodiversity\n\nProper assessing biodiversity is foundation of many subsequent analyses in ecology. We surely often heard the term \"Biodiversity\", and we all know what that means. But how do we quantify it in research? How do we compare biodiversity in time-space? The term is divided into three terms in ecology: the **alpha**, **beta** and **gamma** diversity. \n\nSimply speaking, alpha diversity refers to the diversity within a particular area or ecosystem. Beta diversity measures the difference between these areas. And gamma diversity encloses the diversity of all areas and represents an overall diversity. If we simply use the number of species present (species richness) as the measurement of biodiversity, these three types of diversity can be illustrated as follow:\n\n|                 | Habitat I   | Habitat II   | Habitat III   |\n| :-------------- | :---------- | :----------- | :------------ |\n| Species A       | x           |              |               |\n| Species B       | x           |              |               |\n| Species C       | x           | x            |               |\n| Species D       | x           | x            |               |\n| Species E       |             | x            |               |\n| Species F       |             | x            |               |\n| Species G       |             | x            |               |\n| Species H       |             | x            | x             |\n| Species I       |             |              | x             |\n| Species J       |             |              | x             |\n|                 |             |              |               |\n| **Alpha Diversity** | 4           | 6            | 3             |\n| **Beta Diversity**  | I vs. II: 6 | I vs. III: 7 | II vs. III: 7 |\n| Unique species  | A, B, E, F  | All species  | C, D, E, F, G, I, J |\n| **Gamma Diversity** |             | 10           |               |\n\n: Illustration of different types of diversity calculated by species richness. `x` indicates species' presence. Alpha diversity sums up species present in each habitat, beta diversity counts for unique species in both habitats, gamma diversity represents number of species ever present. {#tbl-diversities}\n\n## Species Richness and Rarefaction\n\nLike we just did in @tbl-diversities, assessing diversity with species richness (SR) data is the most intuitive and straightforward way, but it also has many limitations. First, it does not provide abundance data, we could only know how many species are present, but not in what extent. This means that if we encountered a common species and a rare species, they are equally treated in SR. At the same time, it's sensitive to sample size, and this response is not linear. Which means assuming our sampling is completely random (idealy), the probability of encountering a rare species increases as our sampling effort. But the increase of the total number of encountered species will become slower, and the response curve will then reach a plateau. \n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\ngspecies <- round(rgamma(1000, 50), digit = 0)\n\ncount_species <- function(n, pool) {\n    sampling <- replicate(n, sample(pool, 1, replace = T))\n    df <- data.frame(effort = 1:n)\n    df$species.count <- map_int(df$effort, \\(x) length(unique(sampling[1:x])))\n    df$sample <- map_chr(df$effort, \\(x) as.character(sampling[x]))\n    return(df)\n}\n\ndf <- count_species(200, gspecies)\n\nmax <- max(df$species.count)*1.1\n\nclr <- zhehaoColor(\"elbfaehre\")\n\nggplot() +\n    use_palette_ggplot(\"elbfaehre\") +\n    geom_step(data = df, aes(x = effort, y = species.count), direction = \"hv\", color = clr[1]) +\n    annotate(\"text\", x = 200, y = max, label = \"n = 200\", color = clr[1]) +\n    annotate(\"text\", x = 150, y = 7, label = paste0(\"Total species in pool: \", length(unique(gspecies)))) +\n    labs(x = \"Sampling effort\", y = \"Encountered Species\")\n```\n\n::: {.cell-output-display}\n![Simulation of random sampling from a species pool. Species occurrance are not equal (i.e. there are common and rare species). Y axis represents accumulated species count.](draftbiodiversity-what-how_files/figure-html/fig-species-count-1.png){#fig-species-count fig-align='center' width=672}\n:::\n:::\n\n\n\nBecause of this non-linear course of the SR curve, we cannot compare SR from different site by simply compare the species count devided by sample size. An widely used alternative is rarefaction, but \n\n\n\n::: {.cell .column-page layout-ncol=\"2\" layout-align=\"center\"}\n\n```{.r .cell-code  code-fold=\"true\"}\nclr <- zhehaoColor(\"copenhagen3\", 10)\n\nsimulate.field <- function(index, sampling.effort) {\n\n    species.pool <- round(\n        rgamma(\n            n = 1000, # use gamma distribution to generate uneven species abundance\n            shape = runif(1, 5, 200) # randomize gamma distribution for every simulation\n            ), digit = 0)\n    \n    # sampling from species pool\n    sampling <- replicate(sampling.effort, sample(species.pool, 1, replace = T)) \n\n    # organize data\n    df <- data.frame(effort = 1:sampling.effort)\n    df$species.count <- map_int(df$effort, \\(x) length(unique(sampling[1:x])))\n    df$sample <- map_chr(df$effort, \\(x) as.character(sampling[x]))\n    df$site <- LETTERS[index]\n\n    sim <- list(df = df, sp.pool = length(unique(species.pool)))\n    return(sim)\n}\n\nn <- 15 # number of simulation\n\nsim.index <- data.frame(index = c(1:n), efforts = c(runif(n, 150, 500))) # random effort for each simulation\n\nsim <- map2(sim.index$index, sim.index$efforts, \\(x, y) simulate.field(x, y)) %>% list_transpose()\nsim.sample <- list_rbind(sim$df)\n\n# Plot species count curve\nsim.sample %>% group_by(site) %>% ggplot() +\n    geom_step(aes(x = effort, y = species.count, color = site), direction = \"hv\") +\n    geom_text(\n        data = sim.sample %>% \n            group_by(site) %>% \n            summarise(max_x = max(effort), max_y = max(species.count)),\n        aes(\n            x = max_x + 50, \n            y = max_y, \n            label = paste0(site, \": \", max_y, \" (\", sim$sp.pool, \")\"), \n            color = site), \n        check_overlap = F) +\n    xlim(c(-5, 600)) +\n    use_palette_ggplot(\"porco\", n) +\n    labs(x = \"Sample\", y = \"Species\") +\n    theme(legend.position = \"none\")\n\n# Summarize abundance matrix \ncommunity <- map_df(c(1:length(sim$df)), \\(x) summary(factor(sim$df[[x]]$sample)))\ncommunity[is.na(community)] <- 0\ncommunity <- as.data.frame(community)\nrownames(community) <- LETTERS[1:n]\n\n# Rarefy\nraremin <- min(rowSums(community, na.rm = T)) # least effort (sample size) of all sites (simulations) \nrarefied <- tibble(Site = LETTERS[1:n], Rarefied_SR = rarefy(community, raremin)) %>% arrange(desc(Rarefied_SR))\n\n# Prepare for plot\nrarefied.txt <- paste(rarefied$Site, round(rarefied$Rarefied_SR, digit = 3), sep = \": \")\nrarefied.tbl <- paste0(\"Rarefied SR \\n\\n\", paste(rarefied.txt, collapse = \"\\n\"))\n\n# Rarefaction curve\ntidy.rare <- rarecurve(community, tidy = T) # `tidy = TRUE` will return a matrix for ggplot processing instead of directly drawing a plot\ntidy.rare %>% ggplot() +\n    geom_vline(aes(xintercept = raremin), color = \"#BBB8\", linetype = \"dashed\") + # raremin line\n    geom_line(aes(x = Sample, y = Species, color=Site)) +\n    geom_text(\n        data = tidy.rare %>% \n            group_by(Site) %>% \n            summarise(max_x = max(Sample), max_y = max(Species)) %>% \n            mutate(index = match(Site, LETTERS)), \n        aes(\n            x = max_x + 50, \n            y = max_y, \n            label = paste0(Site, \": \", max_y, \" (\", sim$sp.pool, \")\"), \n            color = Site), \n        check_overlap = F) +\n    annotate(\"text\", x = 660, y = 30, label = rarefied.tbl) +\n    xlim(c(-5, 700)) +\n    use_palette_ggplot(\"porco\", n) +\n    theme(legend.position = \"none\")\n```\n\n::: {.cell-output-display}\n![Species accumulation curve.](draftbiodiversity-what-how_files/figure-html/fig-rarefaction-curve-1.png){#fig-rarefaction-curve-1 fig-align='center' width=672}\n:::\n\n::: {.cell-output-display}\n![Rarefaction curve.](draftbiodiversity-what-how_files/figure-html/fig-rarefaction-curve-2.png){#fig-rarefaction-curve-2 fig-align='center' width=672}\n:::\n:::\n\n\n\n## Diversity index\n\nSince the simple species richness is not sufficient to appropriately assessing the diversity, we need some other analysis to both including species richness and eveness of a system. A diversity index is a mathematical measure of speceis diversity in a given community.\n\nA diversity index is a mathematical measure of speceis diversity in a given community, it is based on the **species richness** and the **species abundance** (the number of individuals per species). \n\n- Represents biodiversity in different aspects (richness, evenness, and dominance).\n- Type of interest also include genera, families, functional types, haplotypes, etc.\n- Entity of interest is usually individuals.\n- Measure of abundance can be number of individuals, biomass or coverage.\n\n### Shannon index (H)\n\n$$ H = -\\sum \\limits_{i=1}^S p_i \\ln p_i\n$$\n\nThe **Shannon index** (aka Shannon's diversity index, Shannon-Wiener index) by _Claude Shannon (1948)_ quantifies the entropy (hence _Shannon entropy_), the main idea is to make prediction of the next encounter inside given community (originally the next letter inside strings of text). The more species there are, and the closer their proportional abundances, the more difficult it is to correctly predict which species will be the next to encounter, this index thus accounts for uncertainty. \n\nFor easy understanding, imagine drawing a ball out of a untransparent box (the classic metaphor), if there are only a few colors and one of them is in absolute dominance, it's not difficult to guess what we will got. But if there are many colors and also equally many in the box, it becomes difficult to predict which one will be drawed next. \n\n- $p$: the proportion ($\\frac{n}{N}$) of individuals of one particular species found ($n$) divided by the total number of individuals found ($N$).\n- $S$: species richness.\n- $H$ ranges from 0 to $H_\\text{max}$, where $H_\\text{max}$ is different for each community and calculated as the species have complete evenness.\n\n### Simpson index ($\\lambda$)\n\n**CAREFUL**: there is an ambiguous usage of the term _Simpson index_ in ecological literature, which is usually referred to Gini-simpson index (see @sec-gini-simpson-index).\n\nThe **Simpson index** by _Edward H. Simpson (1949)_ measures the degree of concentration when individuals are classified into types. \n\n- Represents the probability that two entities taken at random from the dataset of interest belong to the same type.\n\n$$ \\lambda = \\sum \\limits^S_{i=1}(\\frac{n_i}{N})^2 = \\sum \\limits^S_{i=1} p_i^2\n$$\n\n- $p$: the proportion abundance ($\\frac{n}{N}$) of individuals of one particular species found ($n$) divided by the total number of individuals found ($N$).\n- $S$: species richness.\n- The proportional abundance itself is also used as weight here (see weighted arithmetic mean).\n- Ranges from $\\frac{1}{S}$ to 1.\n- *Detour*: the same formula was rediscovered by _Orris C. Herfindahl_ in 1950, thus the same things is usually referred to as Herfindahl index or Herfindahl-Hirschman index (HHI) in economics.\n\n### Inverse Simpson index ($\\frac{1}{\\lambda} = \\, ^2D$)\n\nAnother transformation of the original Simpson index.\n\n- AKA **Simpson's Dominance index**, ranges from 1 to $S$.\n\n### Gini-Simpson index ($1-\\lambda$) {#sec-gini-simpson-index}\n\nThe **Gini-Simpson index** (aka Gini impurity, Gini's diversity index) is a transformation of the original Simpson index. Usually referred to as _Simpson index_ in ecology (again, very ambiguous and very confusing!)\n\n- Accounts for the probability that the two randomly drawn entities belong to different types.\n- More intuitive in term of diversity.\n- AKA the **Probability of interspecific encounter (_PIE_)** in ecology; Gibbs-Martin index in sociology and psychology; expected heterozygosity in population genetics.\n\n### Evenness index\n\nRepresents how close in numbers each species are in a community. \n\n$$ J = \\frac{H}{H_\\text{max}}\n$$\n\n$J$ ranges from 0 to 1, where 1 indicates the absolute evenness. \n\n- Used as measurement of **species dominance**.\n\n## R\n\n`vegan::diversity()` calculates the ecological diversity indices, with Shannon index being default, Simpson or Invisimpson index can also be choosed.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsimpson <- diversity(community, \"simpson\") \nsimpson \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n        A         B         C         D         E         F         G         H \n0.9666068 0.9714996 0.9738429 0.9679121 0.9708059 0.9595960 0.9717580 0.9647016 \n        I         J         K         L         M         N         O \n0.9540609 0.9733870 0.9757059 0.9364653 0.9776307 0.9678843 0.9710782 \n```\n\n\n:::\n\n```{.r .cell-code}\nshannon <- diversity(community)\nshannon #Typically ranges from 1.5 - 3.4, higher = more diverse \n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n       A        B        C        D        E        F        G        H \n3.587413 3.701626 3.822818 3.577138 3.706434 3.387888 3.725558 3.518733 \n       I        J        K        L        M        N        O \n3.214291 3.796422 3.857357 2.887929 3.928504 3.568962 3.693800 \n```\n\n\n:::\n:::\n\n::: {.cell}\n::: {.cell-output-display}\n![](draftbiodiversity-what-how_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\nSimpson index shows the probability of randomly drawing two observations given the observations are from different species.\n\nShannon index gives more importance to rare species, therefore shows higher frequency of the intermediate value.\n\n## Dissimilarity\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in vegdist(community[, 3:11], \"bray\"): you have empty rows: their dissimilarities may be\n                 meaningless in method \"bray\"\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in vegdist(community[, 3:11], \"bray\"): missing values in results\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](draftbiodiversity-what-how_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n\n## Reference\n\n::: {#refs}\n:::\n\n::: {.callout-caution appearance=\"minimal\" style=\"font-sze:0.9rem; border-left: none; border: 1px solid var(--clcolor);\" collapse=\"true\"}\n\n## [R session and R packages]{.cl-title}\n\n\n\n#### R session \n\nR version 4.4.1 (2024-06-14)\nPlatform: aarch64-apple-darwin20\nRunning under: macOS Sonoma 14.5\n\nMatrix products: default\nBLAS:   /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRblas.0.dylib \nLAPACK: /Library/Frameworks/R.framework/Versions/4.4-arm64/Resources/lib/libRlapack.dylib;  LAPACK version 3.12.0\n\nlocale:\n[1] en_US.UTF-8/en_US.UTF-8/en_US.UTF-8/C/en_US.UTF-8/en_US.UTF-8\n\ntime zone: Europe/Berlin\ntzcode source: internal\n\nattached base packages:\n[1] stats     graphics  grDevices utils     datasets  methods   base     \n\nother attached packages:\n [1] vegan_2.6-8             lattice_0.22-6          permute_0.9-7          \n [4] zhehaoColors_0.0.0.9000 lubridate_1.9.3         forcats_1.0.0          \n [7] stringr_1.5.1           dplyr_1.1.4             purrr_1.0.2            \n[10] readr_2.1.5             tidyr_1.3.1             tibble_3.2.1           \n[13] ggplot2_3.5.1           tidyverse_2.0.0         pacman_0.5.1           \n\n\n#### Packages \n\n\n\n**pacman**\n\n\nVersion: 0.5.1 \n\nRinker TW, Kurkiewicz D (2018). _pacman: Package Management for R_.\nversion 0.5.0, <http://github.com/trinker/pacman>.\n\n\n**tidyverse**\n\n\nVersion: 2.0.0 \n\nWickham H, Averick M, Bryan J, Chang W, McGowan LD, François R,\nGrolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E,\nBache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi\nK, Vaughan D, Wilke C, Woo K, Yutani H (2019). \"Welcome to the\ntidyverse.\" _Journal of Open Source Software_, *4*(43), 1686.\ndoi:10.21105/joss.01686 <https://doi.org/10.21105/joss.01686>.\n\n\n**zhehaoColors**\n\n\nVersion: 0.0.0.9000 \n\nHu Z (2024). _zhehaoColors: Using Aesthetics From Zhehao's\nPhotographs_. R package version 0.0.0.9000.\n\n\n**vegan**\n\n\nVersion: 2.6.8 \n\nOksanen J, Simpson G, Blanchet F, Kindt R, Legendre P, Minchin P,\nO'Hara R, Solymos P, Stevens M, Szoecs E, Wagner H, Barbour M, Bedward\nM, Bolker B, Borcard D, Carvalho G, Chirico M, De Caceres M, Durand S,\nEvangelista H, FitzJohn R, Friendly M, Furneaux B, Hannigan G, Hill M,\nLahti L, McGlinn D, Ouellette M, Ribeiro Cunha E, Smith T, Stier A, Ter\nBraak C, Weedon J (2024). _vegan: Community Ecology Package_. R package\nversion 2.6-8, <https://CRAN.R-project.org/package=vegan>.\n\n\n:::\n\n",
    "supporting": [
      "draftbiodiversity-what-how_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}