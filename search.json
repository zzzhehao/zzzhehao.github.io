[
  {
    "objectID": "about.html",
    "href": "about.html",
    "title": "About",
    "section": "",
    "text": "About this site",
    "crumbs": [
      "About me"
    ]
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "",
    "text": "We have multidimensional data in ecology, almost always, and they are huge. Since an n-dimensional data requires an n-dimensional space to be 1:1 displayed, if we want to have at least an overview, we need to reduce dimensions. There’s a few technics can achieve that, which are called as multidimensional scaling (MDS), the widely used metric MDS is PCoA and its special type PCA using euclidean distance."
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#the-problem",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#the-problem",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "",
    "text": "We have multidimensional data in ecology, almost always, and they are huge. Since an n-dimensional data requires an n-dimensional space to be 1:1 displayed, if we want to have at least an overview, we need to reduce dimensions. There’s a few technics can achieve that, which are called as multidimensional scaling (MDS), the widely used metric MDS is PCoA and its special type PCA using euclidean distance."
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#what-is-nmds",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#what-is-nmds",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "What is NMDS?",
    "text": "What is NMDS?\nThe non-metric multidimensional scaling (NMDS) is, as its name implicates, the MDS for non-metric data. Which can be more convenient in ecology, since the ecological data often don’t follow the normal distribution.\nAs Wikipedia explains, the NMDS finds a non-parametric monotonic relationship between the dissimilarities in the item-item matrix and the Euclidean distance between items, and the location of each item in the low-dimensional space.\nTranslate this into simplified language, it says the NMDS …\n\nhighlights the similarities between samples of multidimensional measurements.\nreduces the dimensions of the multidimensional data, but the number of dimensions are predefined, in contrast to PCA and PCoA, which always show the most important two axes.\nanalyses distance matrix, which is commonly a dissimilarity distance matrix.\nis a visualization method, it has thus less precision and much less accountability for further usage of the analysis result in compare to the PCA. For a statistical assessment, additional tests regarding to particular hypothesis must be performed, and that’s why we are combining NMDS with PERMANOVA.\nuses a rank based approach (which makes NMDS a non-metric technic), this rank is maintained consistent while reducing dimensions (monotonic).\nis an iterative algorithm, which use stress values to guide the iteration (see ?metaMDS Details#4). NMDS tries to improve the iteration by randomly choosing starting point.\n\n\nStress\nThe inconsistency between the original high-dimensional data and the reduced low-dimensional data is measured by stress in each iteration. The value ranges from 0 to 1, where 0 means a perfecto fit and 1 means a big yikes.\nGenerally, stress values below 0.2 are considered acceptable, below 0.1 is good. The stress value should be reported with NMDS while publishing results.\nHigher number of samples often leads to higher stress value, also a very low stress value might indicate that the dataset is too small for the NMDS."
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#getting-started",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#getting-started",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Getting started",
    "text": "Getting started\nWe will use the metaNDS() from package vegan to calculate the NMDS and visualize the result using ordiplot(). As demonstration, we use a tadpole abundance data collected in a Madagascan rain forest:\n\nsource(\"ProjectAnalysis/Data_Manipulation/tadpole_clean.R\")\ntadpoleSp &lt;- tadpoleSp[, -1] #drop first column (transects)\n\n\ndim(tadpoleSp)\n\n[1] 29 45\n\nstr(tadpoleSp[, c(1:6)]) # only showing the first 6 species\n\ntibble [29 × 6] (S3: tbl_df/tbl/data.frame)\n $ Boophis albilabris   : num [1:29] 0 0 0 0 0 0 0 0 0 0 ...\n $ Boophis albipunctatus: num [1:29] 0 0 0 0 0 0 0 0 0 0 ...\n $ Boophis andohahela   : num [1:29] 18 0 0 1 0 0 0 0 0 0 ...\n $ Boophis ankaratra    : num [1:29] 0 0 0 0 0 0 0 0 0 0 ...\n $ Boophis elenae       : num [1:29] 75 0 40 0 0 0 0 0 0 0 ...\n $ Boophis luteus       : num [1:29] 29 0 0 0 0 0 0 0 0 0 ..."
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#running-nmds",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#running-nmds",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Running NMDS",
    "text": "Running NMDS\nThe metaMDS has an argument autotransform defaults to TRUE, which arbitrarily transforms data if they exceeded certain sizes. However, the transformation should better be done independently.\n\ntadNMDS &lt;- metaMDS(tadpoleSp, k=2, autotransform = FALSE)\n\nThe code above will print out stress values from each iteration. The result with the least stress value can also be called out afterwards:\n\ntadNMDS\n\n\nCall:\nmetaMDS(comm = tadpoleSp, k = 2, autotransform = FALSE) \n\nglobal Multidimensional Scaling using monoMDS\n\nData:     tadpoleSp \nDistance: bray \n\nDimensions: 2 \nStress:     0.1713697 \nStress type 1, weak ties\nBest solution was not repeated after 20 tries\nThe best solution was from try 11 (random start)\nScaling: centring, PC rotation, halfchange scaling \nSpecies: expanded scores based on 'tadpoleSp'"
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#visualizing-nmds",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#visualizing-nmds",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Visualizing NMDS",
    "text": "Visualizing NMDS\nordiplot is a function specialized on visualizing ordination result from vegan. We can control the representation of sites or species easily using type and display argument. A simple plot with points will look like this:\n\nordiplot(tadNMDS, type = \"p\")\n\n\n\n\n\n\n\n\nor with the site displayed in their numbers:\n\nordiplot(tadNMDS, type = \"p\", display = \"species\")\norditorp(tadNMDS, display = \"site\") # orditorp plots text by default"
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#fitting-environmental-data-using-vegan",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#fitting-environmental-data-using-vegan",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Fitting environmental data using vegan",
    "text": "Fitting environmental data using vegan\nAvailable environmental data could be combined with NMDS to identify potential driver in the community composition and help explain their clustering patterns.\n\nstr(env[, c(1:6)]) # only showing the first 6 variables\n\ntibble [29 × 6] (S3: tbl_df/tbl/data.frame)\n $ stream          : chr [1:29] \"Ambatolahy II\" \"Ambatolahy III\" \"Ambatovory Barrage\" \"Ambodiamontana\" ...\n $ date            : POSIXct[1:29], format: \"2007-03-08\" \"2007-03-10\" ...\n $ site            : chr [1:29] \"Ambatolahy II\" \"Ambatolahy III\" \"Ambatovory\" \"Ambodiamontana\" ...\n $ S (hddd°mm,mmm°): chr [1:29] \"21°14,468'\" \"21°14,464'\" \"21°13,862'\" \"21°15,249'\" ...\n $ E (hddd°mm,mmm°): chr [1:29] \"047°25,591'\" \"047°25,624'\" \"047°25,436'\" \"047°25,197'\" ...\n $ altitude [m asl]: num [1:29] 965 973 1028 935 982 ...\n\n\nThe two variable I’m showing here are both continuous, which will automatically result a 3d-representation, those are the two axes from NMDS and the third axis showing the environmental variable. Since we only have two dimensions, the third variable is represented as a projection of the 3d-surface. We use ordisurf here to fit a smooth surface to the environmental data, which calls gam() (generalized additive model) in the background (I might get back to this with more detailed explanation in the future).\n\ndepth &lt;- env.comp$`Depth (cm)`\n\npar(mfrow = c(1,2))\nordiplot(tadNMDS, type = \"p\", display = 'species', ylim = c(-1, 1), xlim = c(-0.5, 1))\norditorp(tadNMDS, display = \"site\", add = TRUE)\nordisurf(tadNMDS, depth, main = 'Depth', col = 'darkgreen', add = TRUE)\n\n\nFamily: gaussian \nLink function: identity \n\nFormula:\ny ~ s(x1, x2, k = 10, bs = \"tp\", fx = FALSE)\n\nEstimated degrees of freedom:\n6.81  total = 7.81 \n\nREML score: 109.042     \n\naltitude &lt;- env.comp$`altitude [m asl]`\n\nordiplot(tadNMDS, type = \"p\", display = 'species', ylim = c(-1, 1), xlim = c(-0.5, 1))\norditorp(tadNMDS, display = \"site\", add = TRUE)\nordisurf(tadNMDS, altitude, main = 'Altitude', col = 'blue', add = TRUE)\n\n\n\n\n\n\n\n\n\nFamily: gaussian \nLink function: identity \n\nFormula:\ny ~ s(x1, x2, k = 10, bs = \"tp\", fx = FALSE)\n\nEstimated degrees of freedom:\n0.893  total = 1.89 \n\nREML score: 168.5154"
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#plotting-nmds-using-ggplot2",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#plotting-nmds-using-ggplot2",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Plotting NMDS using ggplot2",
    "text": "Plotting NMDS using ggplot2\nIf you have ever worked with ggplot2 and its enormous family, you probably can’t go back to basic R plots. Fortunately, there’s a way to plot, not only the NMDS, also other ordination analyses from vegan using ggplot2. This can make our plot more precise and customizable.\n\nlibrary(ggplot2)\n\nWe continue with the already available NMDS result from earlier, which is stored inside tadNMDS. The only thing we need to do, is to extract the coordinates from the points we want to plot, and then apply them in a ggplot-way.\n\n# extract NMDS scores\nsiteCoord &lt;- as_tibble(scores(tadNMDS)$sites)\nspCoord &lt;- as_tibble(scores(tadNMDS)$species)\n\np.NMDS.sp &lt;- ggplot()+\n  coord_equal() +\n  theme_aes() + # available in source code Rmd\n  MoMAColor() + # available in source code Rmd\n  theme(aspect.ratio = 1) +\n  geom_point(data = spCoord, aes(x = NMDS1, y = NMDS2), size = 2, shape = 3, color = \"red\", alpha = 0.9) +\n  ylim(-1.6, 2)\n\np.NMDS.sp.st &lt;- p.NMDS.sp +\n  geom_point(data = siteCoord, aes(x = NMDS1, y = NMDS2), color = \"#222222\", size = 3.5, alpha = 0.5) +\n  geom_text(data = siteCoord, aes(x = NMDS1, y = NMDS2, label = c(1:nrow(siteCoord))), color = \"white\", size = 1.8, alpha = 1, check_overlap = T)\n\np.NMDS.sp.st\n\n\n\n\n\n\n\n\nFitting environmental data with ggplot could be a bit complex. First we need to manually apply those on our NMDS:\n\nen &lt;- envfit(tadNMDS, env.comp[, c(3:7, ncol(env.comp):ncol(env.comp))], permutation = 0, na.rm = T) # only fitting a subset of the data\nen\n\n\n***VECTORS\n\n                         NMDS1    NMDS2     r2\naltitude [m asl]      -0.78651  0.61758 0.1076\nstream slope [cm/30m]  0.76696  0.64170 0.5461\ntemperature [°C]      -0.25368  0.96729 0.1871\nWidth (m)             -0.92674 -0.37571 0.6397\nDepth (cm)            -0.95637 -0.29214 0.7817\n\n***FACTORS:\n\nCentroids:\n                    NMDS1   NMDS2\nSpeed_cat[50,60)  -0.8420  0.2476\nSpeed_cat[60,70)   0.8150  1.0054\nSpeed_cat[70,80)   0.5360 -0.1509\nSpeed_cat[80,90)  -0.1156 -0.2092\nSpeed_cat[90,100) -0.0682  0.1230\n\nGoodness of fit:\n              r2\nSpeed_cat 0.2252\n\n5 Beobachtungen als fehlend gelöscht\n\n\nenvfit distinguishes the variables into vectors (continuous) or factor (categorical) variables. For each category (in each categorical variable), the centroid coordinates was calculated, which represents the center of the mass and the average coordination of all points belong to that category.\n\nSpider plot\nThe centroids can be used to plot a spider plot:\n\ncat &lt;- \"Speed_cat\"\ncatlvl &lt;- row.names(en$factors$centroids) \nstr_sub(catlvl, start = 1, end = nchar(cat)) &lt;- '' # fix envfit rownames and extract categories\ncentroids &lt;- as_tibble(en$factors$centroids) %&gt;% mutate(cat = catlvl)\n\nsegs &lt;- left_join(\n  as_tibble(cbind(siteCoord, cat = env.comp$Speed_cat)), \n  as_tibble(setNames(centroids, c(\"cN1\", 'cN2', 'cat')))\n  ) # prepare geom_segment data\n\np.NMDS.sp.st_Speed &lt;- p.NMDS.sp +\n  geom_point(data = siteCoord, aes(x = NMDS1, y = NMDS2, color = env.comp$Speed_cat), size = 3.5, alpha = 0.8) +\n  geom_segment(data = segs, aes(x = NMDS1, y = NMDS2, xend = cN1, yend = cN2, shape = cat, color = cat)) + # lines\n  geom_point(data = centroids, aes(x = NMDS1, y = NMDS2, shape = cat, color = cat), size = 4) + # centroid points\n  geom_text(data = siteCoord, aes(x = NMDS1, y = NMDS2, label = c(1:nrow(siteCoord))), color = \"white\", size = 1.8, alpha = 1, check_overlap = T) +\n  guides(color = guide_legend(\"Fast stream percentage\"), shape = \"none\")\n\np.NMDS.sp.st_Speed\n\n\n\n\n\n\n\n\n\n\nHull plot\nSometimes another hull plot will give a better overview:\n\nchullBorder &lt;- function(site, cat) { # extract outline points\n  site &lt;- cbind(site, cat) %&gt;% group_by(cat)\n  \n  borders &lt;- site %&gt;%\n    group_map(~ chull(.[, c(1,2)])) # extract outline points index\n  \n  hulls &lt;- map2(.x = borders, .y = split(site, site$cat), function(x, y){\n    return(y[x,c(1,2)])\n  }) %&gt;%\n    map2_dfr(., seq_along(.), ~ mutate(.x, cat = factor(.y))) # prepare geom_polygon data\n}\n\nhulls &lt;- chullBorder(siteCoord, env.comp$Speed_cat)\n\np.NMDS.sp.st_Speed &lt;- p.NMDS.sp +\n  geom_polygon(data = hulls, aes(x = NMDS1, y = NMDS2, fill = cat), alpha = 0.3) + # hull\n  geom_point(data = siteCoord, aes(x = NMDS1, y = NMDS2, color = env.comp$Speed_cat), size = 3.5, alpha = 0.8) +\n  guides(color = guide_legend(\"Fast stream percentage\"), fill = \"none\")\n\np.NMDS.sp.st_Speed\n\n\n\n\n\n\n\n\n\n\nContinuous variable: fitting surface\nTo fit a smooth surface on our data, we still use ordisurf from vegan to do the calculation, but we do not let it plot the result directly.\n\ndepth &lt;- ordisurf(tadNMDS ~ env.comp$`Depth (cm)`, plot = FALSE)\nalt &lt;- ordisurf(tadNMDS ~ env.comp$`altitude [m asl]`, plot = FALSE)\nslope &lt;- ordisurf(tadNMDS ~ env.comp$`stream slope [cm/30m]`, plot = FALSE)\n\nAs I mentioned before, the environmental variable of the surface is stored in the third axis, if we take look at the ordination object ordisurf produces (try str(depth), I will not show it here since it is a very huge object), we can find a $grid list containing all the coordinates. We simply need to extract them and plot them on our ggplots.\n\nextract.xyz &lt;- function(obj) {\n  xy &lt;- expand.grid(x = obj$grid$x, y = obj$grid$y)\n  xyz &lt;- cbind(xy, c(obj$grid$z))\n  names(xyz) &lt;- c(\"x\", \"y\", \"z\")\n  return(xyz)\n}\n\ncontour.depth &lt;- extract.xyz(obj = depth)\ncontour.alt &lt;- extract.xyz(obj = alt)\ncontour.slope &lt;- extract.xyz(obj = slope)\n\n\nlibrary(geomtextpath)\np.NMDS.sp.st.depth &lt;- p.NMDS.sp.st +\n  geom_textcontour(data = contour.depth, aes(x, y, z = z), color = moma.colors(\"OKeeffe\")[2]) +\n  geom_text(aes(-0.35, 1.75, label = \"Depth\"), size = 8, fill = \"black\", fontface = \"bold\")\n\np.NMDS.sp.st.alt &lt;- p.NMDS.sp.st +\n  geom_textcontour(data = contour.alt, aes(x, y, z = z), color = moma.colors(\"OKeeffe\")[3]) +\n  geom_text(aes(-0.35, 1.75, label = \"Altitude\"), size = 8, fill = \"black\", fontface = \"bold\") +\n  ylab(\"\")\n\np.NMDS.sp.st.slope &lt;- p.NMDS.sp.st +\n  geom_textcontour(data = contour.slope, aes(x, y, z = z), color = moma.colors(\"OKeeffe\")[5]) +\n  geom_text(aes(-0.35, 1.75, label = \"Stream slope\"), size = 8, fill = \"black\", fontface = \"bold\")\n\nlibrary(ggpubr)\np.NMDS.sp.st_Speed &lt;- p.NMDS.sp.st_Speed + \n  guides(color = \"none\", fill = \"none\") +\n  geom_text(aes(-0.25, 1.75, label = \"Fast stream percentage\"), size = 7, fill = \"black\", fontface = \"bold\") +\n  ylab(\"\")\n\n  \n  \np.NMDS.sp.st.fit &lt;- ggarrange(\n  p.NMDS.sp.st.depth, p.NMDS.sp.st.alt, p.NMDS.sp.st.slope, p.NMDS.sp.st_Speed, \n  ncol = 2, nrow = 2,\n  align = \"hv\"\n  )\np.NMDS.sp.st.fit"
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#what-matters",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#what-matters",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "What matters?",
    "text": "What matters?\nNow, as we have all these fancy plots, let’s talk about what we can interpret from them."
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#permanova",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#permanova",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "PERMANOVA",
    "text": "PERMANOVA\n\nadonis2(tadpoleSp ~ env.comp$`altitude [m asl]`+env.comp$`stream slope [cm/30m]`+env.comp$`Depth (cm)`+env.comp$Speed_cat)\n\nPermutation test for adonis under reduced model\nTerms added sequentially (first to last)\nPermutation: free\nNumber of permutations: 999\n\nadonis2(formula = tadpoleSp ~ env.comp$`altitude [m asl]` + env.comp$`stream slope [cm/30m]` + env.comp$`Depth (cm)` + env.comp$Speed_cat)\n                                 Df SumOfSqs      R2      F Pr(&gt;F)    \nenv.comp$`altitude [m asl]`       1   0.2140 0.02823 0.9943  0.429    \nenv.comp$`stream slope [cm/30m]`  1   0.5500 0.07257 2.5556  0.010 ** \nenv.comp$`Depth (cm)`             1   0.7581 0.10001 3.5222  0.001 ***\nenv.comp$Speed_cat                5   1.7533 0.23131 1.6293  0.017 *  \nResidual                         20   4.3045 0.56789                  \nTotal                            28   7.5799 1.00000                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nadonis2(tadpoleSp ~ env.comp$`stream slope [cm/30m]`+env.comp$`Depth (cm)`+env.comp$Speed_cat)\n\nPermutation test for adonis under reduced model\nTerms added sequentially (first to last)\nPermutation: free\nNumber of permutations: 999\n\nadonis2(formula = tadpoleSp ~ env.comp$`stream slope [cm/30m]` + env.comp$`Depth (cm)` + env.comp$Speed_cat)\n                                 Df SumOfSqs      R2      F Pr(&gt;F)    \nenv.comp$`stream slope [cm/30m]`  1   0.5393 0.07115 2.5654  0.005 ** \nenv.comp$`Depth (cm)`             1   0.8467 0.11171 4.0274  0.001 ***\nenv.comp$Speed_cat                5   1.7788 0.23467 1.6922  0.009 ** \nResidual                         21   4.4150 0.58247                  \nTotal                            28   7.5799 1.00000                  \n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nadonis2(tadpoleSp ~ env.comp$Speed_cat)\n\nPermutation test for adonis under reduced model\nTerms added sequentially (first to last)\nPermutation: free\nNumber of permutations: 999\n\nadonis2(formula = tadpoleSp ~ env.comp$Speed_cat)\n                   Df SumOfSqs      R2      F Pr(&gt;F)\nenv.comp$Speed_cat  5   1.5430 0.20356 1.1757  0.213\nResidual           23   6.0369 0.79644              \nTotal              28   7.5799 1.00000"
  },
  {
    "objectID": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#acknowledgement",
    "href": "Posts/Research/Community_Ecology/4_NMDS_and_PERMANOVA.html#acknowledgement",
    "title": "Community Ecology 4 - NMDS and PERMANOVA",
    "section": "Acknowledgement",
    "text": "Acknowledgement\nI thank here the codes and examples shared by\n\nDr. Jackie Zorz\nDr. Christopher Chizinski\nAllan Cameron\n\nfor helping me finish this post."
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Zhehao Hu",
    "section": "",
    "text": "Community Ecology 4 - NMDS and PERMANOVA\n\n\n\n\n\n\n\n\n\n\n\nJun 29, 2024\n\n\nZhehao Hu\n\n\n\n\n\n\nNo matching items",
    "crumbs": [
      "Home"
    ]
  }
]